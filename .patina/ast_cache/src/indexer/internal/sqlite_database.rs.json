{
  "file": "./src/indexer/internal/sqlite_database.rs",
  "language": "rust",
  "functions": [
    {
      "name": "new",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 38,
      "line_end": 64,
      "doc_comment": null
    },
    {
      "name": "initialize_schema",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 67,
      "line_end": 164,
      "doc_comment": null
    },
    {
      "name": "store_document",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 167,
      "line_end": 210,
      "doc_comment": null
    },
    {
      "name": "get_all_documents",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 213,
      "line_end": 232,
      "doc_comment": null
    },
    {
      "name": "get_all_concepts",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 235,
      "line_end": 252,
      "doc_comment": null
    },
    {
      "name": "store_state_transition",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 255,
      "line_end": 282,
      "doc_comment": null
    },
    {
      "name": "get_document_by_path",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 285,
      "line_end": 305,
      "doc_comment": null
    },
    {
      "name": "transaction",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 308,
      "line_end": 317,
      "doc_comment": null
    },
    {
      "name": "test_sqlite_client_creation",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 328,
      "line_end": 334,
      "doc_comment": null
    },
    {
      "name": "test_schema_initialization",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 337,
      "line_end": 346,
      "doc_comment": null
    },
    {
      "name": "test_document_storage",
      "visibility": "public",
      "async": false,
      "unsafe": false,
      "params": [],
      "returns": null,
      "line_start": 349,
      "line_end": 374,
      "doc_comment": null
    }
  ],
  "types": [
    {
      "name": "SqliteClient",
      "kind": "struct",
      "visibility": "public",
      "fields": [],
      "methods": [],
      "line_start": 12,
      "line_end": 14,
      "doc_comment": null
    },
    {
      "name": "DocumentRecord",
      "kind": "struct",
      "visibility": "public",
      "fields": [],
      "methods": [],
      "line_start": 18,
      "line_end": 25,
      "doc_comment": null
    },
    {
      "name": "ConceptRecord",
      "kind": "struct",
      "visibility": "public",
      "fields": [],
      "methods": [],
      "line_start": 29,
      "line_end": 34,
      "doc_comment": null
    }
  ],
  "imports": [
    {
      "path": "anyhow::{Context, Result}",
      "items": [],
      "alias": null,
      "line": 3
    },
    {
      "path": "rusqlite::{params, Connection, Transaction}",
      "items": [],
      "alias": null,
      "line": 4
    },
    {
      "path": "serde::{Deserialize, Serialize}",
      "items": [],
      "alias": null,
      "line": 5
    },
    {
      "path": "std::path::Path",
      "items": [],
      "alias": null,
      "line": 6
    },
    {
      "path": "std::sync::{Arc, Mutex}",
      "items": [],
      "alias": null,
      "line": 7
    },
    {
      "path": "super::DocumentInfo",
      "items": [],
      "alias": null,
      "line": 9
    },
    {
      "path": "super::*",
      "items": [],
      "alias": null,
      "line": 322
    },
    {
      "path": "crate::indexer::Layer",
      "items": [],
      "alias": null,
      "line": 323
    },
    {
      "path": "std::path::PathBuf",
      "items": [],
      "alias": null,
      "line": 324
    },
    {
      "path": "tempfile::TempDir",
      "items": [],
      "alias": null,
      "line": 325
    }
  ],
  "calls": [
    {
      "target": "parent",
      "caller": "new",
      "line": 40,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "with_context",
      "caller": "new",
      "line": 41,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "std::fs::create_dir_all",
      "caller": "new",
      "line": 41,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "format!",
      "caller": "new",
      "line": 42,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "with_context",
      "caller": "new",
      "line": 46,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Connection::open",
      "caller": "new",
      "line": 46,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "format!",
      "caller": "new",
      "line": 47,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "context",
      "caller": "new",
      "line": 50,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "execute_batch",
      "caller": "new",
      "line": 50,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "new",
      "line": 61,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "Arc::new",
      "caller": "new",
      "line": 62,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "Mutex::new",
      "caller": "new",
      "line": 62,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "initialize_schema",
      "line": 68,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "lock",
      "caller": "initialize_schema",
      "line": 68,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "transaction",
      "caller": "initialize_schema",
      "line": 69,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "context",
      "caller": "initialize_schema",
      "line": 72,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "initialize_schema",
      "line": 72,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "context",
      "caller": "initialize_schema",
      "line": 87,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "initialize_schema",
      "line": 87,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "context",
      "caller": "initialize_schema",
      "line": 101,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "initialize_schema",
      "line": 101,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "context",
      "caller": "initialize_schema",
      "line": 116,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "initialize_schema",
      "line": 116,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "context",
      "caller": "initialize_schema",
      "line": 132,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "initialize_schema",
      "line": 132,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "vec!",
      "caller": "initialize_schema",
      "line": 148,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "with_context",
      "caller": "initialize_schema",
      "line": 158,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "initialize_schema",
      "line": 158,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "format!",
      "caller": "initialize_schema",
      "line": 159,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "context",
      "caller": "initialize_schema",
      "line": 162,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "commit",
      "caller": "initialize_schema",
      "line": 162,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "initialize_schema",
      "line": 163,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "store_document",
      "line": 168,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "lock",
      "caller": "store_document",
      "line": 168,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "transaction",
      "caller": "store_document",
      "line": 169,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "serde_json::to_string",
      "caller": "store_document",
      "line": 172,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "store_document",
      "line": 175,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "params!",
      "caller": "store_document",
      "line": 178,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "store_document",
      "line": 189,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "params!",
      "caller": "store_document",
      "line": 191,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "store_document",
      "line": 196,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "params!",
      "caller": "store_document",
      "line": 199,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "commit",
      "caller": "store_document",
      "line": 208,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "store_document",
      "line": 209,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "get_all_documents",
      "line": 214,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "lock",
      "caller": "get_all_documents",
      "line": 214,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "prepare",
      "caller": "get_all_documents",
      "line": 216,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "stmt\n            .query_map([], |row| {\n                Ok(DocumentRecord {\n                    id: row.get(0)?,\n                    path: row.get(1)?,\n                    layer: row.get(2)?,\n                    title: row.get(3)?,\n                    summary: row.get(4)?,\n                    metadata: row.get(5)?,\n                })\n            })?\n            .collect::<Result<Vec<_>, _>>",
      "caller": "get_all_documents",
      "line": 218,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "query_map",
      "caller": "get_all_documents",
      "line": 218,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "get_all_documents",
      "line": 220,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_documents",
      "line": 221,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_documents",
      "line": 222,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_documents",
      "line": 223,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_documents",
      "line": 224,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_documents",
      "line": 225,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_documents",
      "line": 226,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "get_all_documents",
      "line": 231,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "get_all_concepts",
      "line": 236,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "lock",
      "caller": "get_all_concepts",
      "line": 236,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "prepare",
      "caller": "get_all_concepts",
      "line": 238,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "stmt\n            .query_map([], |row| {\n                Ok(ConceptRecord {\n                    concept: row.get(0)?,\n                    document_id: row.get(1)?,\n                    relevance: row.get(2)?,\n                    confidence: row.get(3)?,\n                })\n            })?\n            .collect::<Result<Vec<_>, _>>",
      "caller": "get_all_concepts",
      "line": 240,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "query_map",
      "caller": "get_all_concepts",
      "line": 240,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "get_all_concepts",
      "line": 242,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_concepts",
      "line": 243,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_concepts",
      "line": 244,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_concepts",
      "line": 245,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_all_concepts",
      "line": 246,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "get_all_concepts",
      "line": 251,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "store_state_transition",
      "line": 264,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "lock",
      "caller": "store_state_transition",
      "line": 264,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "serde_json::to_string",
      "caller": "store_state_transition",
      "line": 265,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "execute",
      "caller": "store_state_transition",
      "line": 267,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "params!",
      "caller": "store_state_transition",
      "line": 271,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "store_state_transition",
      "line": 281,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "get_document_by_path",
      "line": 286,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "lock",
      "caller": "get_document_by_path",
      "line": 286,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "prepare",
      "caller": "get_document_by_path",
      "line": 287,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "query_map",
      "caller": "get_document_by_path",
      "line": 293,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "params!",
      "caller": "get_document_by_path",
      "line": 293,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "get_document_by_path",
      "line": 294,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_document_by_path",
      "line": 295,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_document_by_path",
      "line": 296,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_document_by_path",
      "line": 297,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_document_by_path",
      "line": 298,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_document_by_path",
      "line": 299,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get",
      "caller": "get_document_by_path",
      "line": 300,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "get_document_by_path",
      "line": 304,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "transpose",
      "caller": "get_document_by_path",
      "line": 304,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "next",
      "caller": "get_document_by_path",
      "line": 304,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "transaction",
      "line": 312,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "lock",
      "caller": "transaction",
      "line": 312,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "transaction",
      "caller": "transaction",
      "line": 313,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "f",
      "caller": "transaction",
      "line": 314,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "commit",
      "caller": "transaction",
      "line": 315,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "Ok",
      "caller": "transaction",
      "line": 316,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_sqlite_client_creation",
      "line": 329,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "TempDir::new",
      "caller": "test_sqlite_client_creation",
      "line": 329,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "join",
      "caller": "test_sqlite_client_creation",
      "line": 330,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "path",
      "caller": "test_sqlite_client_creation",
      "line": 330,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_sqlite_client_creation",
      "line": 332,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "SqliteClient::new",
      "caller": "test_sqlite_client_creation",
      "line": 332,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "assert!",
      "caller": "test_sqlite_client_creation",
      "line": 333,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_schema_initialization",
      "line": 338,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "TempDir::new",
      "caller": "test_schema_initialization",
      "line": 338,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "join",
      "caller": "test_schema_initialization",
      "line": 339,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "path",
      "caller": "test_schema_initialization",
      "line": 339,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_schema_initialization",
      "line": 341,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "SqliteClient::new",
      "caller": "test_schema_initialization",
      "line": 341,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_schema_initialization",
      "line": 342,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "initialize_schema",
      "caller": "test_schema_initialization",
      "line": 342,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_schema_initialization",
      "line": 345,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "initialize_schema",
      "caller": "test_schema_initialization",
      "line": 345,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_document_storage",
      "line": 350,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "TempDir::new",
      "caller": "test_document_storage",
      "line": 350,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "join",
      "caller": "test_document_storage",
      "line": 351,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "path",
      "caller": "test_document_storage",
      "line": 351,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_document_storage",
      "line": 353,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "SqliteClient::new",
      "caller": "test_document_storage",
      "line": 353,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_document_storage",
      "line": 354,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "initialize_schema",
      "caller": "test_document_storage",
      "line": 354,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "to_string",
      "caller": "test_document_storage",
      "line": 357,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "PathBuf::from",
      "caller": "test_document_storage",
      "line": 358,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "to_string",
      "caller": "test_document_storage",
      "line": 360,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "to_string",
      "caller": "test_document_storage",
      "line": 361,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "vec!",
      "caller": "test_document_storage",
      "line": 362,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "std::collections::HashMap::new",
      "caller": "test_document_storage",
      "line": 363,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_document_storage",
      "line": 366,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "store_document",
      "caller": "test_document_storage",
      "line": 366,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_document_storage",
      "line": 369,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "get_document_by_path",
      "caller": "test_document_storage",
      "line": 369,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "assert!",
      "caller": "test_document_storage",
      "line": 370,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "unwrap",
      "caller": "test_document_storage",
      "line": 371,
      "is_method": true,
      "is_async": false
    },
    {
      "target": "assert_eq!",
      "caller": "test_document_storage",
      "line": 372,
      "is_method": false,
      "is_async": false
    },
    {
      "target": "assert_eq!",
      "caller": "test_document_storage",
      "line": 373,
      "is_method": false,
      "is_async": false
    }
  ]
}