# Session: Patina RAG design review
**ID**: 20251125-065729
**Started**: 2025-11-25T11:57:29Z
**LLM**: claude
**Git Branch**: patina
**Session Tag**: session-20251125-065729-start
**Starting Commit**: 6541d761416ad2d48d9dfe62569e5f435e68062a

## Previous Session Context
Deep dive into Patina's direction completed: reviewed 9 spec documents and 4 key sessions, validated the 6-dimension model architecture (semantic, temporal, dependency, syntactic, architectural, social) where only semantic requires lived session experience while other 5 can bootstrap from git/code immediately. Chose "Path C" approach - build 2-3 high-value dimensions (temporal via co_changes, dependency via call graph) then Scry, then validate before full 6-dimension investment. MLX strategy confirmed as additive (ONNX cross-platform + MLX for bigger models on Mac).

## Goals
- [ ] Patina RAG design review

## Activity Log
### 06:57 - Session Start
Session initialized with goal: Patina RAG design review
Working on branch: patina
Tagged as: session-20251125-065729-start

### 07:15 - ML Expert Review Complete

**Scope:** Comprehensive review of Patina's RAG architecture through the lens of "From Strings to Synthesis: The Evolution and Future of AI-Driven Search" white paper.

**Documents Reviewed:**
- `layer/core/build.md` - Roadmap and phase tracking
- `layer/dust/research-2025/model-strategy-research.md` - 882-line MLX/Qwen3 strategy
- Sessions: 20251124-220659 (deep dive), 20251120-110914 (progressive adapters), 20251116-194408 (E5 benchmark), 20251123-222456 (MLX research)
- Git history: 30 recent commits showing Phase 1→2 progression

**Key Findings:**

1. **Architecture Alignment with Search Evolution**
   - Patina correctly moved from lexical to semantic (E5-base-v2, USearch HNSW)
   - 6-dimension adapter model goes BEYOND white paper's hybrid search
   - "Patina thickness" model is genuine contribution to RAG thinking

2. **Critical Gap: Stuck at "Semantic Only"**
   - Phase 2 complete but only 1/6 dimensions implemented
   - No query interface (Scry) - can't validate architecture end-to-end
   - No evaluation framework - can't measure if dimensions add value

3. **Quantified State:**
   | Metric | Value |
   |--------|-------|
   | Events in DB | 16,027 |
   | Session events | 2,174 |
   | Trained dimensions | 1/6 (semantic only) |
   | Indexed vectors | 1,807 |
   | Scry implementation | 0% |

4. **Missing Hybrid Component:**
   - White paper emphasizes lexical + semantic orchestration
   - Patina has semantic only, no BM25/FTS5 for exact-match queries
   - SQLite FTS5 would be low-overhead addition

**Recommendations (Priority Ordered):**

1. **Build temporal dimension** (1-2 days)
   - `co_changes` table already materialized
   - Validates multi-dimension training pipeline
   - Lowest risk, highest learning

2. **Build Scry MVP** (3-5 days)
   - Vector search + SQLite metadata enrichment
   - `patina scry "query"` → tagged results
   - Validates architecture end-to-end

3. **Add lexical search** (optional, 1 day)
   - SQLite FTS5 for exact-match queries
   - True hybrid search per white paper

4. **Defer model upgrades**
   - E5-base-v2 validated on real data
   - Qwen3/MLX invalidates all projections
   - "Don't optimize what you can't measure"

5. **Build evaluation framework before 3rd dimension**
   - Without metrics, dimension value is speculation
   - Retrieval precision/recall on held-out queries

**Key Decision: Path C Confirmed**
- Build 2-3 dimensions → Scry → Evaluate → Then decide on remaining dimensions
- MLX/Qwen3 is nice-to-have, not blocking
- Focus ruthlessly on: temporal → Scry → eval

**Andrew Ng Principle Applied:**
> "Don't optimize what you can't measure. Build temporal, build Scry, build eval. Then iterate."


### 09:46 - Update (covering since 06:57)

**Git Activity:**
- Commits this session: 8
- Files changed: ~120 (63 deleted, 55 archived, 3 restored)
- Last commit: 73 seconds ago

**Work Completed:**

1. **ML Expert Review** (Andrew Ng hat)
   - Reviewed Patina RAG architecture vs "Strings to Synthesis" white paper
   - Analyzed build.md, model-strategy-research.md, 4 key sessions, 30 commits
   - Identified critical gap: stuck at "semantic only" (1/6 dimensions)
   - Confirmed Path C: temporal → Scry → eval → then decide

2. **Refocused build.md Roadmap**
   - Added guiding principle: "Don't optimize what you can't measure"
   - Defined Phase 2.5: temporal dimension + Scry MVP + evaluation
   - Explicitly deferred MLX/Qwen3/remaining dimensions
   - Added key sessions table for context recovery
   - Added concrete validation criteria

3. **Major Surface Cleanup** (55 docs → dust)
   - Created `layer/surface/build/` for 9 roadmap specs
   - Archived 55 outdated/completed docs to `layer/dust/archive/`
   - Kept 12 architecture docs (active code + philosophy)
   - Converted 882-line model research to 107-line spec

4. **Code Verification Deep Dive**
   - Verified archived docs against actual codebase
   - Restored 3 docs for active code: yolo, patina-metal (2)
   - Confirmed: yolo command, patina-metal crate, 10 language parsers all active

**Key Decisions:**
- Surface = doing/will do OR applicable philosophy
- Dust = didn't do OR won't do
- Build specs in dedicated folder with consistent format
- Model strategy deferred until evaluation proves architecture

**Commits:**
```
12e2bfe8 chore(surface): archive completed refactoring docs
32373846 docs(surface): restore docs for active working code
91ab35bd docs(build): convert model research to spec-model-runtime.md
504151ec refactor(build): move model-strategy-research to build folder
ba3dfd85 chore(surface): archive 55 outdated docs to dust
f27f0290 refactor(surface): move build specs to dedicated folder
cee9f6a3 docs(build): refocus roadmap on Phase 2.5 validation path
e48fd3c0 docs(sessions): archive sessions 20251122-20251124
```

**Patterns Observed:**
- Scalpel commits (8 focused commits vs 1 big bang)
- Code verification essential before doc cleanup
- 882→107 line reduction shows value of spec format


## Session Classification
- Work Type: pattern-work
- Files Changed:       78
- Commits:        8
- Patterns Modified:       78
- Session Tags: session-20251125-065729-start..session-20251125-065729-end
