# Session: ref-repo-semantic
**ID**: 20260107-143753
**Started**: 2026-01-07T19:37:53Z
**LLM**: claude
**Git Branch**: patina
**Session Tag**: session-20260107-143753-start
**Starting Commit**: 5bd27bad2def0f9fe9665b74d05310f28beabf33

## Previous Session Context
Last session (20260107-113628) investigated semantic search quality across ref repos. Key findings: commit-based semantic achieves 75-83% hit rate with static parameters; discovered recipe creation gap where `patina repo add` doesn't auto-enable semantic even when commits exist (only 4/13 repos had semantic indexes). Built eval queryset with ground truth for 4 repos - all 6 "failures" were ground truth issues, semantic was actually correct. Identified three failure scenarios: verbose enterprise repos, tiny focused libraries (<50 commits), and monorepos with mixed conventions.

## Goals
- [x] Fix recipe creation to auto-enable semantic when commits exist
- [x] Document findings in spec-ref-repo-semantic.md
- [ ] Consider dynamic parameters vs static magic numbers (deferred)

## Activity Log
### 14:37 - Session Start
Session initialized with goal: ref-repo-semantic
Working on branch: patina
Tagged as: session-20260107-143753-start


### 15:33 - Update (covering since 14:37)

**Git Activity:**
- Commits this session: 3
- Files changed: 4
- Last commit: 64 seconds ago

**Work Completed:**
- Fixed recipe creation gap: Updated `src/commands/repo/internal.rs` to include semantic projection in default template
- Rebuilt all 13 ref repos with `patina repo update --all --oxidize`
- 11/13 repos now have semantic indexes (was 4/13 before fix)
- Updated spec-ref-repo-semantic.md with results table and token length issue
- Updated build.md Phase 3 status

**Key Findings:**
- Recipe fix worked perfectly - new template includes all three projections
- SDL and livestore fail on semantic due to ONNX token length error (> 512 tokens)
- Token length issue is pre-existing, affects large functions

**Commits:**
```
9cd241c7 fix(repo): auto-enable semantic in recipe when commits exist
b069a8c5 docs(spec): mark recipe creation gap as fixed
7ef07cf5 docs: update Phase 3 status - 11/13 repos have semantic indexes
```

**Next:** Token length fix (truncation/chunking) for SDL and livestore


## Session Classification
- Work Type: pattern-work
- Files Changed:        3
- Commits:        3
- Patterns Modified:        2
- Session Tags: session-20260107-143753-start..session-20260107-143753-end
