---
type: session
id: 20260202-104403
title: spec-drift-fix + E4.6 semantic grounding
status: archived
llm: claude
created: 2026-02-02T15:44:03Z
start_timestamp: 1770047043863
git:
  branch: patina
  starting_commit: a295ac0e238a0437d5989ed2124ab7a40103d3a4
  start_tag: session-20260202-104403-claude-start
---

## Previous Session Context
Closed E4.5 (belief-verification) — archived the spec, updated build.md milestones to v0.9.4 with 46 beliefs. Major restructure of the epistemic-layer SPEC: compressed stale E4.5 design context, added E4.6 split into grounding (E4.6a: belief↔code/commit/session) before clustering (E4.6b: belief↔belief similarity), and expanded E5 scope. Key session insight: spec drift is hostile to LLM collaboration — stale specs poison context reboots. Captured `stale-context-is-hostile-context` belief and scoped `practical-memory-over-epistemic-formalism`. Next priorities wired into build.md: (1) spec drift detection spec, (2) E4.6a semantic grounding, (3) E4.6b similarity.

## Goals
- [x] Write spec-drift-detection SPEC (Priority 1)
- [x] Implement `scry --belief` mode — E4.6a steps 1-2
- [ ] Surface belief grounding in audit — E4.6a step 3 (in progress, interrupted)
- [ ] Compute grounding scores during scrape — E4.6a step 5

## Activity Log
### 10:44 - Session Start
Session initialized with goal: spec-drift-fix + E4.6 semantic grounding
Working on branch: patina
Tagged as: session-20260202-104403-claude-start

### 10:44-11:00 — Priority 1: Spec Drift Detection SPEC

**Completed.** Created `layer/surface/build/feat/spec-drift-detection/SPEC.md` — a three-layer
design for detecting stale specs before LLMs read them:

1. **Temporal drift**: Compare `updated:` frontmatter date vs git commits on related files.
   Layer scraper currently parses `created:` but not `updated:`. All 10 active specs have
   `updated:` fields. Thresholds: 0-7 fresh, 7-30 aging, 30+ stale.
2. **Status contradiction**: Cross-reference spec `status:` against checkbox completion state.
   Detects specs that appear complete but still say "building."
3. **Spec assertions**: Machine-checkable claims about spec currency (SQL queries, file checks).
   Same pattern as belief verification — connect claims to DB facts.

Surfacing in: `patina scrape` output, `patina doctor`, `patina session start` (stale specs
touching current branch). Registered in build.md under Features.

Commit: `4bb49ee` spec(feat): add spec-drift-detection

### 11:00-11:30 — Priority 2: E4.6a Semantic Belief Grounding (steps 1-2)

**Completed.** Implemented `patina scry --belief <id>` — retrieves a belief's embedding vector
from the usearch index and finds nearest neighbors across all 5 content types.

**Code changes (4 files):**
- `src/commands/scry/internal/search.rs`: New `scry_belief()` function following the `scry_file()`
  pattern. Gets belief rowid from DB, computes `BELIEF_ID_OFFSET + rowid`, retrieves vector from
  index, kNN search, enrichment, self-filter (removes both belief.surface and pattern.surface).
- `src/commands/scry/mod.rs`: Added `belief: Option<String>` and `content_type: Option<String>`
  to ScryOptions. Updated execute() match to route belief queries.
- `src/main.rs`: Added `--belief <id>` and `--content-type <type>` CLI flags to Scry command.
- `src/mcp/server.rs`: Added `belief` mode to MCP schema with `content_type` parameter.

**Testing:**
- `patina scry --belief sync-first` → returns nearest beliefs, sessions, patterns (0.90-0.92 scores)
- `patina scry --belief measure-first --content-type beliefs` → returns semantically similar beliefs
- `patina scry --belief stale-context-is-hostile-context` → found the spec-drift-detection SPEC
  we just created as a neighbor (0.890) — the system already connects belief to spec
- Index must be fresh (`patina oxidize`) — stale index returns 0.000 scores

**Key finding:** Code symbols don't appear in top neighbors for most beliefs because code
embeddings are short/formal ("Function `insert_event` in `eventlog.rs`") while beliefs are rich
natural language. This is an expected limitation of pure semantic similarity for belief→code
grounding — hybrid approaches or enriched code embeddings would improve this.

Commit: `04abdb5` feat(scry): add --belief mode for semantic belief grounding (E4.6a)

### 11:30 — E4.6a Step 3: Belief Grounding in Audit (interrupted)

**In progress.** Started adding `--grounding` flag to `patina belief audit` that computes and
displays semantic grounding for each belief on-the-fly using the usearch index. The implementation
loads the index once, iterates over all beliefs, gets each vector, searches for neighbors, and
categorizes by type (code/commits/sessions). Code written but not yet compiled or tested —
session ended mid-implementation.

**Also updated:** epistemic-layer SPEC E4.6a — marked steps 1-2 and exit criteria as complete,
updated `updated:` field to 2026-02-02 (practicing what we preach about stale specs).


## Beliefs Captured: 0
_No beliefs captured this session_

## Session Classification
- Work Type: pattern-work
- Files Changed: 9
- Commits: 5
- Patterns Modified: 3
- Beliefs Captured: 0
- Session Tags: session-20260202-104403-claude-start..session-20260202-104403-claude-end

## User Prompts (2)

1. `[Pasted text #1 +24 lines]`
2. `/session-end `
