# Session: ref-repo-semantic
**ID**: 20260107-093317
**Started**: 2026-01-07T14:33:17Z
**LLM**: claude
**Git Branch**: patina
**Session Tag**: session-20260107-093317-start
**Starting Commit**: c45193e15a2f0eae55ab46c918a748fdc05da624

## Previous Session Context
Last session (20260107-061556 "mother") created the comprehensive implementation spec `layer/surface/build/spec-ref-repo-semantic.md` to address the ref repo semantic gap: ref repos have `dependency.usearch` but NO `semantic.usearch` because semantic projection trains on session observations which ref repos lack. The solution is commit-based semantic training using (message, diff) pairs as (NL, code) training data—approximately 100 lines for `generate_commit_pairs()` plus fallback logic. Mothership-graph was archived as complete with tag `spec/mothership-graph`, and build.md was updated to make ref-repo-semantic the current focus.

## Goals
- [ ] ref-repo-semantic build
- [ ] Implement generate_commit_pairs() (~100 lines)
- [ ] Add semantic training fallback for repos without sessions
- [ ] Run on Tier 1-2 repos (gemini-cli, dojo, opencode, codex, livestore)
- [ ] Measure before/after on ref repo queries

## Activity Log
### 09:33 - Session Start
Session initialized with goal: ref-repo-semantic
Working on branch: patina
Tagged as: session-20260107-093317-start


### 10:21 - Update (covering since 09:33)

**Git Activity:**
- Commits this session:        4
- Files changed: 0
- Last commit: 2 minutes ago

**Work Completed:**
- Created `src/commands/oxidize/commits.rs` (372 lines) - commit-based training pair generation
- Added fallback logic in `oxidize semantic`: sessions → commits → error
- Fixed path normalization (`./foo` vs `foo` mismatch between tables)
- Added graceful patterns table check for ref repos
- Ran oxidize on Tier 1 (gemini-cli) and Tier 2 (dojo, opencode, codex, livestore)
- Updated spec with Phase 1 results and Phase 2 observation

**Key Decisions:**
- Use `function_facts` for positive/negative samples (same as semantic index)
- Normalize paths by stripping leading `./` for consistent matching
- Check patterns table existence before querying (ref repos don't have layer/)

**Measurement Results:**
- BEFORE: FTS5 fallback returned text matches on "telemetry"
- AFTER: Semantic search returns actual telemetry functions (`updateTelemetryTokenCount`, `ActivityMonitor`, `MemoryMonitor`)

**Architectural Insight (Phase 2):**
User observation: commits and sessions are BOTH first-class signals, not fallback alternatives.
- Commits: code cohesion (what changes together) - exists in projects + ref repos
- Sessions: user intent (what user thinks about together) - exists only in projects
Current design uses one OR the other. Better design: use ALL available signals.

**Commits:**
```
d89d03e2 feat(oxidize): add commit-based semantic training for ref repos
9eebc9e9 feat(oxidize): fallback to commits when no sessions exist
0bb2ec09 session: archive mother session (spec creation)
61509e83 docs(spec): update ref-repo-semantic with Phase 1 results
```


## Session Classification
- Work Type: pattern-work
- Files Changed:        4
- Commits:        4
- Patterns Modified:        2
- Session Tags: session-20260107-093317-start..session-20260107-093317-end
