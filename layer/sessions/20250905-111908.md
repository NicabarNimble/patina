# Session: llm-code-intelligence-design review and edits
**ID**: 20250905-111908
**Started**: 2025-09-05T15:19:08Z
**LLM**: claude
**Git Branch**: work
**Session Tag**: session-20250905-111908-start
**Starting Commit**: 63413de85fd3ca021838727a93c5f56d8f061add

## Previous Session Context
The last session focused on analyzing and fixing the scrape command's pattern detection issues. Key accomplishments included removing obsolete behavioral_hints and git_metrics tables (466 lines), identifying that hardcoded pattern prefixes miss project-specific conventions like SDL_*, and updating the LLM code intelligence design doc with reality-based insights about tree-sitter's syntactic limitations and the need for evidence-based pattern extraction.

## Goals
- [ ] llm-code-intelligence-design review and edits

## Activity Log
### 11:19 - Session Start
Session initialized with goal: llm-code-intelligence-design review and edits
Working on branch: work
Tagged as: session-20250905-111908-start


### 13:56 - Update (covering since 11:19)

**Git Activity:**
- Commits this session:        4
- Files changed: 4
- Last commit: 57 seconds ago

**Work Completed:**
- Deep analysis of llm-code-intelligence-design.md document and code.rs implementation
- Created new `ask` command structure to handle pattern discovery:
  - `src/commands/ask/mod.rs` - Command routing and database connection
  - `src/commands/ask/patterns.rs` - Adaptive pattern discovery from extracted data
- Successfully tested ask command on SDL repo - discovers SDL_ (3493), HIDAPI_ (579) patterns from data
- Partially cleaned `scrape` command by removing pattern detection logic
- Created handoff document at `layer/surface/scrape-to-ask-refactor-status.md`

**Key Decisions:**
- **Separation of Concerns**: `scrape` should only extract facts, `ask` should analyze them
- **No Two-Pass Architecture**: Initial attempt at two-pass failed due to language AST differences
- **Adaptive Discovery Works**: Ask command proves patterns can be discovered from function_facts table
- **Keep It Simple**: Rather than complex refactoring, just move pattern code to ask command
- **Document for Handoff**: Created detailed status doc due to context limits

**Challenges & Solutions:**
- **Challenge**: Initial two-pass architecture failed - couldn't collect all function names
- **Root Cause**: C functions have different AST structure than Python/JS, missed most C functions
- **Solution**: Reverted changes, documented lesson, opted for simpler approach

- **Challenge**: code.rs has 3+ inconsistent language handling systems
- **Root Cause**: Evolution over time led to LanguageSpec, special processing, and generic patterns
- **Solution**: Work with existing extraction, let ask do pattern discovery from stored data

- **Challenge**: Removing patterns module cleanly from 3400+ line file
- **Issue**: Module boundaries unclear, accidentally renamed patterns to languages
- **Status**: Partially complete, documented remaining work in handoff doc

**Patterns Observed:**
- **Data-Driven Discovery Works**: Query `SELECT substr(name, 1, instr(name||'_','_'))` finds real patterns
- **Hardcoded Lists Fail**: The "get_", "set_" list missed SDL_, gtk_, all project-specific patterns
- **Separation Enables Evolution**: Ask command can evolve pattern discovery without touching extraction
- **LLMs Need Evidence**: "Based on 334 functions" better than "Option-preferred" guessing
- **Failed Experiments Are Memory**: Documented two-pass failure prevents repeating mistake


## Session Classification
- Work Type: pattern-work
- Files Changed:        9
- Commits:        4
- Patterns Modified:        3
- Session Tags: session-20250905-111908-start..session-20250905-111908-end
