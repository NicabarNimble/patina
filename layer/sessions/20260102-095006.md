# Session: review
**ID**: 20260102-095006
**Started**: 2026-01-02T14:50:06Z
**LLM**: claude
**Git Branch**: patina
**Session Tag**: session-20260102-095006-start
**Starting Commit**: c0b0833db9fa78f2f1a99ee7e89cf0f318ff3083

## Previous Session Context
Designed and implemented Phase 0.25 intent-aware retrieval including `src/retrieval/intent.rs` (QueryIntent detection), weighted RRF fusion, and a temporal queryset of 10 session-derived queries. Benchmarking showed baseline MRR of 0.179 but intent weighting regressed to 0.104 - root cause identified as boosting semantic hurting lexical-sourced results. Open items: try temporal-only boosting and add sessions_fts table.

## Goals
- [ ] Review spec-mothership.md to understand current state
- [ ] Review src/retrieval system (engine.rs, fusion.rs, intent.rs)
- [ ] Identify gaps and next steps for Phase 0.25

## Activity Log
### 09:50 - Session Start
Session initialized with goal: review
Working on branch: patina
Tagged as: session-20260102-095006-start


### 12:41 - Update (covering since 09:50)

**Git Activity:**
- Commits this session:        0
- Files changed: 9
- Last commit: 6 hours ago

**Work Completed:**
- Deep review of spec-mothership.md, layer/core values, and recent git/session history
- Diagnosed why Phase 0.25 intent detection went wrong (put detection inside scry instead of exposing as MCP param)
- Discovered 12 of 13 ref repos missing commits_fts and moments (only dojo had full pipeline)
- Traced workflow: `patina repo update` + `patina assay derive-moments` brings repo to full state
- Successfully updated opencode repo as proof (6539 commits indexed, 171 moments detected)

**Discussion Context:**
- Sutton vs Ng framing: we're not building RL (system learns), we're building for human-in-loop learning (Ng style)
- LLM is in the middle - should leverage LLM intelligence, not duplicate with keyword heuristics
- Determinism principle: flexibility at orchestration layer (LLM), determinism at tool layer (patina)

**Key Decisions:**
1. Set aside sessions A/B comparison - focus on ref repo measurement first
2. Intent detection should NOT be inside scry - expose as MCP parameter instead
3. Need to update all 13 ref repos before we can properly evaluate git narrative
4. Patina should be self-documenting (shouldn't need to grep source to understand workflows)

**Challenges Faced:**
- Spec got muddy: Phase 0 changed from "Persona surfacing" to "Git Narrative" mid-stream
- Temporal queryset mixed patina-specific queries (require sessions) with ref repo queries
- Incremental scrape didn't backfill commits_fts - needed full `repo update`
- Had to grep source to understand patina workflows - MCP/scry should have helped

**Patterns Observed:**
- "Measure first, tune second" was stated but not followed - built intent detection before measuring baseline
- Sessions capture outcomes but not reproducible procedures (how did dojo get to current state?)
- Good insight, wrong execution pattern: conceptual discoveries were sound, implementation went sideways


### 17:15 - Update (covering since 12:41)

**Git Activity:**
- Commits this session:        0
- Files changed: 9
- Last commit: 10 hours ago

**Work Completed:**
- Updated all 13 ref repos to full pipeline state (commits_fts + moments)
- Total indexed: 48,560 commits, 1,968 moments, 146,854 code symbols
- Discovered workflow: `patina repo update` + `patina assay --repo X derive-moments`
- Verified opencode as proof of concept before scaling to all repos

**Discussion Context:**
- Refocused on core question: "Can git narrative answer temporal questions about ref repos?"
- Set aside sessions A/B comparison, intent detection, weighted fusion
- Andrew Ng approach: understand what we have before trying to improve it

**Key Decisions:**
1. Focus evaluation on ref repos only (no patina-specific queries)
2. Build queryset answerable from git alone (when/what questions)
3. Ground truth comes from actual git history (verifiable commits)

**Challenges Faced:**
- Zsh loop syntax issues - worked around with individual commands
- Initial confusion about why 12 repos missing commits_fts (incremental scrape gap)
- Had to run commands sequentially due to shell scripting limitations

**Patterns Observed:**
- Simple workflow exists (`repo update` + `derive-moments`) but wasn't documented
- Self-documentation gap: had to discover workflow empirically, not through patina tools

**Ref Repo Summary (all at full state):**
| Repo | Commits | Moments |
|------|---------|---------|
| SDL | 20,844 | 293 |
| opencode | 6,539 | 171 |
| gemini-cli | 3,742 | 277 |
| scryer-prolog | 3,624 | 37 |
| dojo | 2,702 | 380 |
| codex | 2,600 | 75 |
| livestore | 2,225 | 387 |
| USearch | 1,798 | 139 |
| starknet-foundry | 1,665 | 95 |
| dust | 963 | 55 |
| daydreams | 960 | 34 |
| game-engine | 536 | 5 |
| PAI | 362 | 30 |


### 14:28 - Update (covering since 17:15)

**Git Activity:**
- Commits this session:        0
- Files changed: 9
- Last commit: 31 hours ago

**Session Summary (Final):**
- No additional work since last update - session ending

**Session Outcomes:**
1. Diagnosed Phase 0.25 execution problems (intent detection in wrong place)
2. Updated all 13 ref repos to full pipeline state
3. Established clear next step: build ref repo queryset with git-verifiable ground truth
4. Key insight: Sutton vs Ng framing - we're building for human-in-loop learning, not RL

**Uncommitted Changes (from previous session):**
- 435 lines across 5 files (intent detection code that needs review)
- Decision: leave uncommitted until we decide direction on intent/mode simplification


## Session Classification
- Work Type: exploration
- Files Changed:        0
- Commits:        0
- Patterns Modified:        0
- Session Tags: session-20260102-095006-start..session-20260102-095006-end
