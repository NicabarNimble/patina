# Session: specs
**ID**: 20260101-161602
**Started**: 2026-01-01T21:16:02Z
**LLM**: claude
**Git Branch**: patina
**Session Tag**: session-20260101-161602-start
**Starting Commit**: 15e7472bee6f803a832d40b7da26f114ce16cd49

## Previous Session Context
Last session ("secrets") investigated the keychain popup issue on Mac Studio and created `layer/surface/build/spec-observability.md` - a unified logging spec for the three-layer architecture (mother/patina/awaken). Key insight captured: Andrew Ng's pragmatic ML principles should phase ambition, not delete it - preserve vision with Phase 0 validation, park future ideas with triggers rather than deleting them.

## Goals
- [ ] specs and build and direction

## Activity Log
### 16:16 - Session Start
Session initialized with goal: specs
Working on branch: patina
Tagged as: session-20260101-161602-start


### 17:07 - Update (covering since 16:16)

**Git Activity:**
- Commits this session: 3
- Files changed: 0
- Last commit: 3 minutes ago

**Work Completed:**
- Gathered context from layer/core values, recent git history, specs, and sessions
- Discovered database was stale (code.db zeroed Dec 18, MRR 0.042)
- Ran `patina scrape` + `patina oxidize` to rebuild data
- Established baseline: MRR 0.519, latency p50=150ms, p95=198ms
- Implemented Phase 0 instrumentation in `src/retrieval/engine.rs`:
  - Query timing (total + oracle breakdown)
  - Per-oracle contribution logging (name, count, top-3 doc_ids)
  - Enabled via `PATINA_LOG=1` environment variable
- Updated spec with baseline metrics and error analysis workflow
- Marked all Phase 0 exit criteria complete

**Discussion Context:**
- Started with "anchor in layer/core values" - reviewed all specs and recent sessions
- Identified retrieval optimization as highest-value next step (concrete, code-verified spec)
- Phase 0 = "measure first" before optimizing (Andrew Ng principle)

**Key Decisions:**
1. Rescrape before measuring - can't optimize what you can't measure accurately
2. Manual error analysis workflow for Phase 0 (avoid over-engineering)
3. Surgical commits: instrumentation, spec updates, session archives separately

**Challenges Faced:**
- Database silently stale - no obvious error, just poor MRR
- `OracleResult` has `source` field not `oracle` - quick fix after compiler caught it

**Patterns Observed:**
- 99.7% of query time is oracle execution (confirms model-loading bottleneck hypothesis)
- Semantic oracle returns session docs, lexical returns code - different purposes
- For "where is X" queries, lexical does the heavy lifting

**Phase 0 Learnings Summary:**
1. Bottleneck confirmed: model loading per-query
2. Baseline lower than documented (0.519 vs 0.624) - real number to improve against
3. Oracles serve different purposes - data for Phase 3 intent routing
4. Instrumentation working - `PATINA_LOG=1` shows timing + oracle contributions


### 18:15 - Update (covering since 17:07)

**Git Activity:**
- Commits this session: 8 total (3 Phase 0 + 5 Phase 1)
- Files changed: 0
- Last commit: 42 minutes ago

**Work Completed:**
- **Phase 1 Implementation**: Fixed model-loading bottleneck
  - Added `Send` bound to `EmbeddingEngine` trait
  - Made scry `internal` module public for enrichment reuse
  - Rewrote `SemanticOracle` to own embedder, projection, index via OnceLock
  - Rewrote `PersonaOracle` to own embedder and index via OnceLock
  - Updated spec with Phase 1 results

**Results:**
- p50 latency: 150ms → **22ms** (6.8x faster)
- mean latency: 159ms → **41ms** (3.9x faster)
- Subsequent queries: ~150ms → **17-26ms** (6-8x faster)
- MRR unchanged at 0.519

**Discussion Context:**
- Zoomed out to review recent sessions, git history, all specs
- Identified what's complete vs in-progress vs future
- Applied Andrew Ng lens: "You got your win, now what needs data?"
- Decided to park retrieval optimization (Phases 2-4 need data we don't have)

**Key Decisions:**
1. Phase 1 sufficient for now - 6.8x win shipped
2. Phases 2-4 parked - need 100+ queries for intent routing, weeks for usage learning
3. Next session: Observability + Mothership design (blocking issues over nice-to-haves)
4. Consider adding "Parked Work" section to spec-work-deferred.md

**Session Outcome:**
Built → Measured → Won → Parked. Ready for observability and architecture work.


## Session Classification
- Work Type: pattern-work
- Files Changed:        8
- Commits:        8
- Patterns Modified:        3
- Session Tags: session-20260101-161602-start..session-20260101-161602-end
