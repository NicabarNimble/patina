# Session: Live testing on dojo repo
**ID**: 20251216-114618
**Started**: 2025-12-16T16:46:18Z
**LLM**: claude
**Git Branch**: patina
**Session Tag**: session-20251216-114618-start
**Starting Commit**: f35aa66250c6e0d3562009623a50a63b4ed69bb7

## Previous Session Context
Last session (Phase 2 Build Finish) completed release automation with release-plz, created v0.1.0 baseline tag/release, and merged PRs #59 (paths centralization) and #60 (release-plz workflow). Key fixes: init order-of-operations bug (gitignore modified before branch check), launcher bug (passing project name instead of "."), and added auto-scrape to init flow so MCP tools work immediately. Session included deep dive into Gemini CLI capabilities (full MCP support, native session management). Carryover items: test auto-scrape on fresh repo, create PR for init/launch fixes (3 commits on patina branch), plan Gemini adapter parity work.

## Goals
- [ ] Live testing on dojo repo

## Activity Log
### 11:46 - Session Start
Session initialized with goal: Live testing on dojo repo
Working on branch: patina
Tagged as: session-20251216-114618-start


### 12:29 - Update (covering since 11:46)

**Git Activity:**
- Commits this session: 0
- Files changed: 4
- Last commit: 54 minutes ago

**Work Completed:**
- Reviewed test results from fresh dojo clone - init flow works, scrape completes successfully
- Analyzed MCP tool usage: `patina_context` was called (returned "No patterns found" as expected), but Claude used Explore agent instead of `patina_query` for codebase exploration
- Identified root cause: CLAUDE.md had no guidance directing LLMs to use patina MCP tools
- Renamed MCP tools for CLI parity and clarity:
  - `patina_query` → `scry` (matches `patina scry` CLI command)
  - `patina_context` → `context` (simpler, no redundant "patina")
- Updated tool descriptions to be LLM-directive ("USE FIRST for any question about code")
- Added MCP guidance section to both CLAUDE.md templates (root bootstrap and .claude/CLAUDE.md)
- All pre-push checks pass (fmt, clippy, tests)

**Discussion Context:**
- Debated unified vs separate tools (one `scry` with modes vs `scry` + `context`)
- Anchored decision in layer/core principles: Unix philosophy says "one tool, one job"
- Search (ranked snippets) ≠ Dump (full documents) - different operations
- Primary consumers are LLMs, so directive descriptions matter more than Unix purity
- Separate tools with clear descriptions guide LLM tool selection better

**Key Decisions:**
- Keep `scry` and `context` as separate MCP tools (distinct use cases)
- Tool names mirror CLI: `scry` matches `patina scry`, `context` is new (no CLI equivalent yet)
- Descriptions are directive: "USE FIRST", "USE to understand rules before changes"
- No `patina context` CLI command yet - can add later for full parity

**Challenges:**
- Tool name collision concern (CLI vs MCP) - resolved: different namespaces, same name is beneficial
- Formatting issue from long line in context_generation.rs - cargo fmt fixed it

**Patterns Observed:**
- LLM tool selection depends heavily on description wording - be directive
- CLI/MCP parity reduces cognitive load ("scry" means same thing everywhere)
- Test on real repos (dojo) reveals issues that unit tests miss


### 13:01 - Update (covering since 12:29)

**Git Activity:**
- Commits this session: 1
- Files changed: 8 (in commit a5c2f3fd)
- Last commit: 80 seconds ago

**Work Completed:**
- Deep dive into hybrid RAG architecture: discovered TemporalOracle missing from QueryEngine
  - Git co-change data (75K relationships on dojo) scraped but not queryable via MCP
  - Only 3 oracles: Semantic, Lexical, Persona - no Temporal
- Reviewed archive pattern from git history (commit 14eb6bb1)
- Executed full archive cleanup:
  - Created `spec/release-automation` tag
  - Deleted `spec-folder-structure.md` (preserved via tag)
  - Reset phase numbering: MCP & Retrieval Polish → Phase 1
  - Updated spec-work-deferred.md with new tool names
- Committed all changes (a5c2f3fd): 193 insertions, 704 deletions

**Discussion Context:**
- Explored what data hybrid RAG actually fuses: eventlog, code_fts, pattern_fts, persona
- Clarified that semantic oracle requires `oxidize` (not run on init)
- Discussed whether phases with deferred items are "done" → yes, deferred ≠ incomplete
- Reviewed archive pattern: tag → delete spec → reset numbering → clean slate

**Key Decisions:**
- Phase 1b: Add TemporalOracle to expose co-change data via MCP
- Phase 1c: Evaluate auto-oxidize timing (adds ~30s to init)
- Archive pattern: delete spec files after tagging, reset phase numbers for clean slate

**Patterns Observed:**
- Archive pattern keeps build.md focused on current work (866 → 153 lines in past cleanup)
- Deferred work belongs in spec-work-deferred.md, not left incomplete in build.md
- Fresh project `scry` has limited value until sessions accumulate - that's by design


### 13:02 - Session End

No additional work since last update. Session ending with clean working tree.

**Session Summary:**
- Tested patina init on fresh dojo clone - init/scrape works
- Discovered MCP tools weren't being used effectively (no CLAUDE.md guidance)
- Renamed MCP tools: patina_query → scry, patina_context → context
- Discovered TemporalOracle missing (co-change data not queryable via MCP)
- Archived completed phases, reset to Phase 1

**Carryover for next session:**
- Phase 1b: Add TemporalOracle to QueryEngine
- Phase 1c: Evaluate auto-oxidize timing
- Test MCP changes on fresh dojo clone
- Create PR for commits on patina branch


## Session Classification
- Work Type: pattern-work
- Files Changed:        8
- Commits:        1
- Patterns Modified:        4
- Session Tags: session-20251216-114618-start..session-20251216-114618-end
