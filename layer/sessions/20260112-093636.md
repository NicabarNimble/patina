# Session: project
**ID**: 20260112-093636
**Started**: 2026-01-12T14:36:36Z
**LLM**: claude
**Git Branch**: patina
**Session Tag**: session-20260112-093636-start
**Starting Commit**: 36a696ec73f3bd2ae25fd6c13df3de34834d7f51

## Previous Session Context
Last session implemented forge sync v2 (Unix fork background sync with PID guards, 750ms pacing, --log flag) and created the database identity spec (spec-database-identity.md). Key decisions: hybrid UID model (random for local repos, hash for ref repos), UID stored in `.patina/uid` file to survive DB rebuilds, 32-bit UID with ~1% collision at 9,300 projects, and DB generation tracking in _meta table for staleness detection.

## Goals
- [ ] Project UID and DB implementation

## Activity Log
### 09:36 - Session Start
Session initialized with goal: project
Working on branch: patina
Tagged as: session-20260112-093636-start

### 09:36-12:00 - Spec Design Session

**Work Completed:**

1. **Reviewed spec-database-identity.md** - Identified open questions about UID implementation
   - Resolved: explicit `create_uid()` / `read_uid()` (no magic `ensure_uid()`)
   - Resolved: migration requires explicit `patina init .` (fail with upgrade message)
   - Resolved: collision detection on mother graph registration (warn + log)

2. **Deep dive into init command** - Discovered init fragility:
   - Re-init destroys `frontends.allowed`, `upstream`, `ci` config
   - Config wholesale replacement instead of merge
   - Init does too much (violates Unix philosophy)

3. **Created spec-init-hardening.md** - Comprehensive redesign:
   - Three-command model: `patina init`, `patina frontend`, `patina` (launcher)
   - Init: minimal skeleton (.patina/, layer/) - nothing else
   - Frontend: add/switch/remove/doctor - manages adapters
   - Launcher: invisible glue, user types `patina` and it works
   - Config merge strategy: immutable/preserved/refreshed fields
   - Aligned with core values (unix-philosophy, dependable-rust, adapter-pattern)

4. **Edge case analysis** - Reviewed existing init code for safety:
   - Hierarchy conflict checks (parent .claude/, child .patina/)
   - Git fork/branch management (empty repo, dirty tree, branch behind)
   - Gitignore handling, pattern copying, backup/restore
   - Identified: `.claude` backup moves from init to frontend command
   - Identified: need `patina frontend refresh` for session preservation

**Key Decisions:**
- Human as tastemaker (no automated A/B testing)
- Minimal friction (background logging, no prompts)
- Frontends as dependencies (track via ref repos)
- Observability via events.db (zero-friction collection)

**Specs Modified:**
- `spec-database-identity.md` - Added explicit patterns, migration, collision handling
- `spec-init-hardening.md` - Complete rewrite as init/frontend/launcher spec

**Open Items (for next session):**
- Add edge cases to spec (hierarchy, git, backup)
- Add `patina frontend refresh` command
- Define commit behavior (auto vs manual per command)
- Implementation phases ready to begin


## Session Classification
- Work Type: exploration
- Files Changed:        0
- Commits:        0
- Patterns Modified:        0
- Session Tags: session-20260112-093636-start..session-20260112-093636-end
