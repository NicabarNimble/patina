# Session: Build Continues
**ID**: 20251210-065208
**Started**: 2025-12-10T11:52:08Z
**LLM**: claude
**Git Branch**: patina
**Session Tag**: session-20251210-065208-start
**Starting Commit**: 7429a906b6b322139ed505be3de06b32781afc8f

## Previous Session Context
Last session ("Layer") focused on documentation cleanup in `layer/surface/`: archived 8 large outdated docs (moving conceptual/aspirational content to `layer/dust/`), updated `architecture-neuro-symbolic.md` status section to clearly mark integration and symbol anchoring as NOT YET IMPLEMENTED with placeholder tests, and completed relevance reviews. The session made 1 commit affecting 3 pattern files. Open items from prior work: deeper dive on `architecture-persona-belief` (implementation vs aspirational), update `architecture-patina-system.md` with launcher concepts.

## Goals
- [x] Review build.md and specs
- [x] Research CLAUDE.md best practices and future direction
- [x] Redesign source/presentation model â†’ orchestrator model
- [x] Define allowed frontends model
- [x] Update build.md and specs with new vision
- [ ] Implement allowed frontends (next session)

## Activity Log
### 06:52 - Session Start
Session initialized with goal: Build Continues
Working on branch: patina
Tagged as: session-20251210-065208-start


### 09:33 - Update (covering since 06:52)

**Git Activity:**
- Commits this session: 6
- Files changed: 5 (launch module, build.md, specs)
- Last commit: docs(spec): update template centralization status

**Work Completed:**
1. **Technical cleanup** - Fixed 6 clippy warnings in launch module: removed 5 unused helper functions, eliminated needless match, cleaned up imports
2. **Deep research** - Web research on CLAUDE.md best practices, Claude Code memory hierarchy (4-level system), context engineering patterns, and upcoming memory tool features
3. **Major design revision** - Pivoted from "source/presentation" model (generate CLAUDE.md, gitignore it) to "orchestrator" model (preserve existing files, augment minimally)
4. **Allowed frontends model** - Designed project-level config for controlling which LLM frontends are permitted, with add/remove commands and parallel coexistence
5. **Documentation updates** - Updated build.md (tasks 1d-1g restructured), spec-launcher-architecture.md (key principles rewritten), spec-template-centralization.md

**Key Decisions:**
- **Patina is orchestrator, not generator** - Don't clobber existing CLAUDE.md/GEMINI.md; they're productive for projects. Real value is MCP (Phase 2)
- **Allowed frontends at project level** - Team controls which frontends permitted via `.patina/config.toml [frontends].allowed`
- **Parallel, not exclusive** - Switching frontends doesn't remove files; allowed frontends coexist (both .claude/ and .gemini/ can exist)
- **Backup before modify** - Always backup to `.patina/backups/` before touching existing files
- **Two-tier config** - Global (~/.patina/config.toml) for detected frontends; Project (.patina/config.toml) for allowed frontends

**Challenges Faced:**
- Initial assumption that CLAUDE.md should be gitignored/generated was wrong for real-world projects
- Needed to reconcile existing committed CLAUDE.md with new model
- Research showed Claude Code memory is file-based hierarchy, not something patina should replace

**Patterns Observed:**
- "Scalpel not shotgun" applies to design too - minimal intervention preserves user's existing productive setup
- Dogfooding surfaces real edge cases (patina project has committed CLAUDE.md)
- Future direction (MCP) makes static file generation less important

---

## Handoff for Next Session

### Files Modified This Session
- `src/commands/launch/mod.rs` - removed 5 unused functions, cleaned imports
- `src/commands/launch/internal.rs` - removed needless match in `launch_frontend_cli`
- `layer/core/build.md` - restructured Phase 1 tasks (1d-1g), new validation criteria
- `layer/surface/build/spec-launcher-architecture.md` - major rewrite of key principles
- `layer/surface/build/spec-template-centralization.md` - status update

### Key Commits (in order)
```
e8bf8723 style: format templates.rs with cargo fmt
a06d453f fix(launch): remove dead code and needless match
635934e0 docs(sessions): add Layer session notes
2c6c2b5e docs(build): update Phase 1 with allowed frontends model
3b0b0300 docs(spec): revise launcher architecture for orchestrator model
92bc0ae2 docs(spec): update template centralization status and phase
```

### Implementation Next Steps (Task 1e)

**1. Create ProjectConfig struct** in `src/` (new file or extend existing):
```rust
// Proposed schema
pub struct ProjectConfig {
    pub project: ProjectSection,
    pub frontends: FrontendsSection,
    pub embeddings: EmbeddingsSection,
}

pub struct ProjectSection {
    pub name: String,
    pub mode: String,  // "owner" | "contrib"
}

pub struct FrontendsSection {
    pub allowed: Vec<String>,  // ["claude", "gemini"]
    pub default: String,
}
```

**2. Add load/save functions** - similar to `workspace::load_config()` but for `.patina/config.toml`

**3. Update launch flow** in `src/commands/launch/internal.rs`:
- After project check, before mothership check
- Load project config
- Check if requested frontend is in `allowed` list
- Error with helpful message if not allowed

**4. Wire up adapter commands** in `src/main.rs`:
- `patina adapter add <frontend>` - add to allowed, copy templates
- `patina adapter remove <frontend>` - backup, remove files, update config

### Existing Code to Reference
- `src/workspace/internal.rs` - has `GlobalConfig`, `load_config()`, `save_config()` patterns
- `src/adapters/launch.rs` - has `Frontend` enum, detection logic
- `src/adapters/templates.rs` - has `copy_to_project()` for template copying

### Research Sources (for context)
- [Claude Code Memory Docs](https://code.claude.com/docs/en/memory) - 4-level hierarchy
- [Anthropic CLAUDE.md Blog](https://claude.com/blog/using-claude-md-files) - best practices
- [Anthropic Engineering Best Practices](https://www.anthropic.com/engineering/claude-code-best-practices)


### 09:40 - Update (covering since 09:33)

**Git Activity:**
- Commits this session: 6 total
- Working tree: clean
- Last commit: 7 minutes ago

**Work Completed:**
- Added detailed handoff section to active-session.md for next LLM session pickup
- Included code snippets, file references, and implementation roadmap


## Session Classification
- Work Type: pattern-work
- Files Changed:        7
- Commits:        6
- Patterns Modified:        4
- Session Tags: session-20251210-065208-start..session-20251210-065208-end
