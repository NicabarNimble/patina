# Session: ref
**ID**: 20260108-055659
**Started**: 2026-01-08T10:56:59Z
**LLM**: claude
**Git Branch**: patina
**Session Tag**: session-20260108-055659-start
**Starting Commit**: c5cbbe64588a753fca7c7e84729ff62c5651d822

## Previous Session Context
Last session evaluated semantic search across ref repos. Key findings: ground truth was overly narrow (77% became 100% when checking actual results), tiny repos (<500 vectors) produce noise, and there's a domain terminology gap (e.g., "unification algorithm" fails on scryer-prolog because code uses "unify" not academic terms). Identified potential fixes: skip semantic for tiny repos, add FTS5 stemming, or LLM query expansion.

## Goals
- [x] Review build/spec docs and understand active vs deferred
- [x] Phase 0.5: Persona Surfaces - fix PersonaOracle bug
- [x] Phase 0.25b: Run temporal MRR benchmark
- [x] Clean up build/spec docs (thin completed phases)
- [x] Create new spec for vocabulary gap fix

## Activity Log
### 05:56 - Session Start
Session initialized with goal: ref repos and mothership
Anchored in layer/core values, gathered context from git history and sessions.

### 06:30 - Phase 0.5 Complete
**Found bug:** PersonaOracle querying `beliefs` table but actual table is `knowledge`.
Fixed in `src/retrieval/oracles/persona.rs` - one line change.
Result: `[PERSONA]` results now appear in hybrid scry output.

### 06:45 - Phase 0.25b Benchmark
Ran temporal MRR benchmark: **0.100** (worse than baseline 0.133, target 0.4).
Analysis: Intent detection works, weights apply, but **vocabulary mismatch** is root cause.
User says "commit message search", code says "commits_fts". Same domain terminology gap found in ref repo eval.

### 07:00 - Spec Cleanup
Created `spec-vocabulary-gap.md` for LLM query expansion fix.
Thinned `build.md` (-165 lines) and `spec-mothership.md` (-570 lines).
Pattern: completed work → git tags, active specs stay lean.
Tagged `spec/ref-repo-semantic` as complete.

## Key Decisions
1. **Don't tune weights for vocabulary gap** - weights boost lexical globally, not commits specifically
2. **LLM query expansion is the fix** - let LLM bridge "message search" → "commits_fts"
3. **Completed phases → git tags** - don't carry verbose details in active specs

## Insights
- Same vocabulary gap issue in temporal queries and ref repo semantic eval
- PersonaOracle bug was a simple table name mismatch (beliefs→knowledge)
- Intent detection is implemented but can't fix vocabulary mismatch alone

## Commits
- `7c38f8c8` fix(persona): query knowledge table instead of beliefs
- `b8cbd5b2` docs: update spec-mothership with Phase 0.5 completion
- `ec3c34e2` docs: add Phase 0.25b benchmark results and analysis
- `fabf1dc0` docs: thin build/specs, add vocabulary-gap spec


## Session Classification
- Work Type: pattern-work
- Files Changed:        4
- Commits:        4
- Patterns Modified:        3
- Session Tags: session-20260108-055659-start..session-20260108-055659-end
