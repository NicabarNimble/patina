---
type: session
id: 20260203-120615
title: mother-delivery review
status: archived
llm: claude
created: 2026-02-03T17:06:15Z
start_timestamp: 1770138375748
git:
  branch: patina
  starting_commit: 915e40a322c302530d42bf6ef81b4975d6c70a53
  start_tag: session-20260203-120615-claude-start
---

## Previous Session Context
Deep-dived into Mother architecture (1,849 lines Rust built), OpenClaw (mandatory recall pattern, two-step search), and Gastown (ephemeral context injection, role-based delivery). Synthesized these into the mother-delivery spec (`layer/surface/build/feat/mother-delivery/SPEC.md`) with 5 design changes (D1-D5), updated parent Mother spec to redefine v0.11.0 as "Delivery + Federation", and wired spec into build.md and v1-release. Resolved 3 open design questions in commit 915e40a3: D1 BeliefOracle approach (separate oracle vs SQLite FTS5 vs better tagging), D3 two-step scope (snippets for MCP, full for CLI), and recall directive placement strategy. No beliefs captured.

## Goals
- [x] mother-delivery review — decomposed, grounded, and extended with D0

## Activity Log
### 12:06 - Session Start
Session initialized with goal: mother-delivery review
Working on branch: patina
Tagged as: session-20260203-120615-claude-start

### 12:15 - Spec Decomposition
Decomposed 637-line monolithic [[mother-delivery]] spec into focused sub-specs following the [[epistemic-layer]] precedent (1509 → 66 lines). Created:
- [[d1-belief-oracle/SPEC.md]] — BeliefOracle as default search channel
- [[d2-three-layer-delivery/SPEC.md]] — description → response → graph breadcrumbs
- [[d3-two-step-retrieval/SPEC.md]] — snippets by default, detail on demand
- [[design.md]] — ref repo evidence (OpenClaw, Gastown), 5 ADRs, resolved design questions
- D4 (routing simplification) kept inline in parent, D5 already has own spec
Committed as [[05ebdddf]].

### 12:45 - Grounding Against Codebase (8 Fixes)
Reviewed sub-specs against actual code. Found 8 issues:
1. `belief_fts` already exists (`scrape/beliefs/mod.rs:103`), spec proposed duplicate `beliefs_fts`
2. USearch over-fetch risk — 48 beliefs in thousands of entries needs aggressive over-fetch
3. Federation function name `collect_oracle_results_in_context()` doesn't exist — corrected to `query_repo()`/`query_all_repos()`
4. D2 three layers are independent changes — split exit criteria per layer
5. Context tool `get_project_context()` reads disk only, not SQLite — scope underestimated
6. D3 snippets-by-default is breaking change — added `--full` escape hatch
7. D3/D2 circular dependency — D3 ships without breadcrumbs, D2 Layer 3 adds later
8. 120-char snippet too terse — defined per-content-type snippets (~200 chars code, full beliefs)
Committed as [[dbf28b25]].

### 13:00 - Design.md Review
Updated ADRs with implementation notes, added ADR-6 (over-fetch strategy), collapsed redundant "Resolved Design Questions" into concise Design History. Committed as [[b7857408]].

### 13:15 - Parent SPEC Review (4 Fixes)
1. Added Status Log (spec-system compliance)
2. Rollup exit criteria — split v0.11.0 required vs stretch vs federation (v0.12.0+)
3. Federation criteria scoped out of v0.11.0 — local delivery validated first
4. D4 default behavior change noted — current default is `All` (brute-force 19 repos)
Committed as [[eb1197e9]].

### 13:30 - CLI/MCP Bifurcation Discovery
Deep codebase trace revealed CLI and MCP scry are **different pipelines**:
- MCP always uses QueryEngine (oracles + RRF)
- CLI default bypasses oracles entirely (heuristic auto-detect → direct vector/FTS5)
- `--hybrid` flag (Dec 2025) was experimental on-ramp, never completed

This means D1/D3 only work for MCP without pipeline unification. Three options considered:
1. Make `--hybrid` default (complete the transition)
2. Keep bifurcation, implement D1/D3 twice (wrong — fights architecture)
3. Accept MCP-first (wrong — CLI is the product)

Traced history via git: `--hybrid` introduced [[49cf30c4]] as experimental. MCP built later, used oracle path from day one. Ref repos (OpenClaw, Gastown) have zero dual search paths.

### 14:00 - D0 Unified Search Sub-Spec
Created [[d0-unified-search/SPEC.md]] — foundation change making QueryEngine the default CLI path. Updated parent SPEC implementation order: D0 → D1 → D4 → D3 → D2 → D5. Added ADR-7 to [[design.md]]. Committed as [[ae54e7c9]].

### 14:15 - Board Review + CLI-First Principle
Ran advisory board review (Ng, Sutton, Yegge, Hellard perspectives). Key takeaways:
- Ng: validate D1 on existing path first, measure before building D0
- Sutton: D2 (recall directives) is hand-designed prompt engineering — the search channel IS the recall mechanism
- Yegge: spec-to-code ratio is alarming, 48 beliefs don't need 7 spec files
- Consensus: D2 deferred until data shows it's needed

User clarified CLI-first philosophy: MCP is a necessary evil for tool discovery, CLI is the real product. Created belief [[mcp-is-shim-cli-is-product]]. Updated D0 framing to "CLI Owns the Pipeline" — MCP handlers become thin dispatchers, not parallel implementations. Committed as [[145b396b]].

## Beliefs Captured: 1
- [[mcp-is-shim-cli-is-product]] — MCP exists as discovery shim, CLI is real interface, MCP wraps CLI logic


## Beliefs Captured: 1

## Session Classification
- Work Type: pattern-work
- Files Changed: 8
- Commits: 6
- Patterns Modified: 7
- Beliefs Captured: 1
- Session Tags: session-20260203-120615-claude-start..session-20260203-120615-claude-end

## User Prompts (14)

1. `review our mother delivery spec and lets break it apart so that its not a monolithic spec .. look...`
2. `your call build it`
3. `lets review the sub specs and discuss`
4. `these are good fixes, update the specs`
5. `lets review design.md and discuss`
6. `yes proceed`
7. `lets review the parent spec and discuss`
8. `yes proceed`
9. `review our mother delivery spec vs reality of patina`
10. `i feel mcp is not our vibe as we are living on device and in a cli .. so sure mcp has a role but ...`
11. `yes draft it up`
12. `ok zoom out .. give me a board of advisors review with andrew ng, rich sutton, steve yegge, and h...`
13. `ok lets say that i hate mcp but have to use because cli was hard for llm adapter to know to use ....`
14. `capture it as a belief and update D0 then /session-end`
